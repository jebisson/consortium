---
import SiteLayout from "../layouts/SiteLayout.astro";
import "../styles/global.css";
import logo from "../assets/consortium.png";
import { theme } from "../config/theme.js";

const { background, text, accent, border, bandBackground } = theme.colors;

const points = [
  {
    t: "Protection antivirus moderne (MISE À JOUR IMPORTANTE)",
    lead: [
      "Microsoft n’offre plus gratuitement la licence Business Premium, qui incluait une suite complète d’outils de sécurité. Cette évolution du modèle de licences ouvre la porte à l’utilisation de plateformes de sécurité tierces plus performantes, désormais offertes à un coût comparable.",
      "Ainsi, il est désormais possible de mettre en place une solution de sécurité intégrée, surveillée 24 heures sur 24, 7 jours sur 7, adaptée aux besoins et à la réalité financière des organismes d’aide a domicile.",
      "Une telle solution permet de détecter, bloquer et corriger les menaces en temps réel. Les fonctionnalités EDR (Endpoint Detection and Response) assurent une surveillance constante des comportements anormaux, et tout poste compromis peut être automatiquement isolé afin de limiter la propagation d’une attaque au reste de l’organisation."
    ]
  },
  {
    t: "Inventaire et désuétude des systèmes",
    lead: [
      "L’utilisation de systèmes ou d’équipements désuets accroît les risques de vulnérabilité. L’intégration de Microsoft Intune ou d’une solution de gestion à distance (RMM) permet de maintenir un inventaire complet et à jour des actifs, tout en automatisant la détection et le remplacement des systèmes obsolètes."
    ]
  },
  {
    t: "Détection des vulnérabilités et application des correctifs",
    lead: [
      "Une stratégie de mise à jour automatisée via Windows Update et Intune ou la plateforme de sécurité intégrée assure une protection continue contre les failles connues. La gestion centralisée permet d’appliquer rapidement les correctifs de sécurité sur tous les appareils, y compris ceux utilisés à distance."
    ]
  },
  {
    t: "Authentification multi-facteurs (MFA)",
    lead: [
      "L’activation de l’authentification multi-facteurs à travers Entra ID renforce significativement la sécurité des comptes utilisateurs. Elle empêche l’accès non autorisé même en cas de compromission d’un mot de passe."
    ]
  },
  {
    t: "Sauvegarde et reprise des données Microsoft 365",
    lead: [
      "Une solution de sauvegarde Microsoft 365 couvrant Exchange, OneDrive, SharePoint et Teams est essentielle pour prévenir la perte de données. La planification de tests de restauration périodiques et la conservation hors site garantissent la résilience opérationnelle."
    ]
  },
  {
    t: "Sécurisation des communications électroniques",
    lead: [
      "Les échanges de données confidentielles doivent être protégés par le chiffrement et la sensibilisation des utilisateurs. Microsoft 365 offre des options intégrées de chiffrement de messages et de prévention de la perte de données (DLP)."
    ]
  },
  {
    t: "Analyse des vulnérabilités externes",
    lead: [
      "Une veille continue sur les services exposés à Internet permet d’identifier et de corriger les failles rapidement. L’utilisation de Microsoft Defender External Attack Surface Management ou d’un service équivalent permet cette surveillance proactive."
    ]
  },
  {
    t: "Journalisation et surveillance continue",
    lead: [
      "La journalisation des accès et la détection des anomalies via Microsoft 365 Defender ou la plateforme de sécurité intégrée offrent une visibilité complète sur les événements de sécurité. La corrélation automatisée des alertes réduit le délai de détection et de réponse aux incidents."
    ]
  },
  {
    t: "Notifications d’accès et de modifications de compte",
    lead: [
      "Les utilisateurs doivent être informés de tout changement à leur compte ou de toute connexion inhabituelle. Un système de sécurité intégré permet de configurer des alertes automatisées pour renforcer la transparence et la sécurité."
    ]
  },
  {
    t: "Transmission sécurisée des informations",
    lead: [
      "Les données sensibles doivent être échangées à l’aide de solutions sécurisées et chiffrées, telles que SharePoint ou OneDrive avec liens protégés, plutôt que par courriel non sécurisé."
    ]
  },
  {
    t: "Directives d’utilisation des outils numériques",
    lead: [
      "Une politique claire sur l’utilisation du courriel, d’Internet et des outils Microsoft 365 favorise des comportements sécuritaires et cohérents. Les employés doivent savoir comment réagir à un incident de sécurité."
    ]
  },
  {
    t: "Gestion des accès et des privilèges",
    lead: [
      "Une gestion rigoureuse des accès selon le principe du moindre privilège doit être appliquée. Entra ID et Intune permettent d’automatiser l’ajout, la révision et la révocation des accès, incluant les rôles administratifs."
    ]
  },
  {
    t: "Formation et culture de la sécurité",
    lead: [
      "La sensibilisation continue des employés aux menaces numériques – hameçonnage, rançongiciels, ingénierie sociale – renforce la première ligne de défense de toute organisation. Les formations régulières et les rappels intégrés à Microsoft 365 favorisent une culture de vigilance."
    ]
  },
  {
    t: "Score de sécurité",
    lead: [
      "Microsoft 365 met à disposition un outil d’autoévaluation du niveau de sécurité au sein du Centre d’administration Defender.",
      "Ce score de sécurité permet d’obtenir un portrait clair des mesures de protection déjà en place et de celles qui doivent être renforcées pour assurer une meilleure résilience de la plateforme.",
      "Toutefois, de nombreuses organisations se fient encore à la configuration de base de Microsoft 365, laquelle demeure insuffisante pour atteindre un niveau de sécurité optimal."
    ]
  }
];
---

<SiteLayout title="Sécurité Microsoft 365 – Consortium">
  <div
    style={`--bg:${background}; --text:${text}; --accent:${accent}; --border:${border}; --band:${bandBackground};`}
  >
    <style>
      /* Surfaces noires (comme index) */
      .card-surface {
        background: rgb(18,18,18);
        border: 1px solid rgba(0,0,0,0.16);
        box-shadow: 0 14px 40px rgba(0,0,0,0.18);
      }

      .card-icon {
        background: rgba(255,255,255,0.06);
        border: 1px solid rgba(255,255,255,0.10);
      }

      .hover-tint {
        background: radial-gradient(circle at 18% 18%, color-mix(in srgb, var(--accent) 16%, transparent), transparent 62%);
      }

      .muted-on-dark { color: color-mix(in srgb, white 70%, transparent); }
      .soft-on-dark  { color: color-mix(in srgb, white 82%, transparent); }

      /* Texte sur bande blanche */
      .band-title { color: rgba(17,17,17,0.92); }
      .band-soft  { color: rgba(17,17,17,0.75); }
      .band-muted { color: rgba(17,17,17,0.62); }

      .focus-ring:focus {
        outline: none;
        box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 30%, transparent);
      }

      .backbtn:hover {
        border-color: color-mix(in srgb, var(--accent) 65%, transparent);
        filter: brightness(1.06);
      }
    </style>

    <!-- HEADER SLOT -->
    <div slot="header" class="flex flex-col items-center">
      <img src={logo.src} alt="Consortium" class="h-32 md:h-36 w-auto" />
      <h1
        class="mt-2 text-sm tracking-[0.35em] uppercase"
        style="color: color-mix(in srgb, var(--text) 60%, transparent);"
      >Services TI
      </h1>
    </div>

    <!-- HERO SLOT (dark, simple, glow discret) -->
    <div slot="hero" class="relative mx-auto max-w-4xl px-4 text-center z-20 pt-2 pb-10">
      <div
        class="pointer-events-none absolute left-1/2 top-8 -translate-x-1/2 w-[70%] md:w-[55%] h-24 blur-[80px] opacity-70"
        style="background: color-mix(in srgb, var(--accent) 18%, transparent);"
      ></div>

      <h2 class="mt-5 text-4xl md:text-5xl font-semibold tracking-tight" style="color: var(--text);">
        Faites de la cybersécurité un réflexe quotidien.
      </h2>

      <h3 class="mt-3 text-lg md:text-xl font-semibold soft-on-dark">
        Sécurité et résilience numérique — Bonnes pratiques et modernisation avec Microsoft 365.
      </h3>

      <p class="mt-3 text-sm muted-on-dark">
        Survolez chaque point pour voir le détail.
      </p>
    </div>

    <!-- BACK LINK -->
    <a
      href="/"
      class="backbtn fixed right-6 top-5 z-50 inline-flex items-center px-4 py-2 rounded-lg shadow-lg backdrop-blur transition-all"
      style={`
        background: rgba(18,18,18,0.85);
        border: 1px solid rgba(255,255,255,0.10);
        color: color-mix(in srgb, white 90%, transparent);
      `}
    >
      ← Retour à la page Services TI
    </a>

    <!-- BAND (BLANC) -->
    <section class="relative w-full overflow-hidden" style="background: var(--band);">
      <!-- LIGNE OR + FADE (comme index) -->
      <div class="h-[2px] w-full" style="background: var(--accent);"></div>
      <div
        class="h-14 w-full"
        style="background: linear-gradient(to bottom, color-mix(in srgb, var(--accent) 18%, transparent), transparent);"
      ></div>

      <!-- Contenu -->
      <div class="relative mx-auto max-w-5xl px-4 pt-6 pb-6">
        <div class="grid md:grid-cols-2 gap-6">

          <!-- Audit -->
          <section class="group relative overflow-hidden rounded-2xl p-8 card-surface">
            <div class="pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 group-hover:opacity-100 hover-tint"></div>

            <div class="relative">
              <p class="text-xs uppercase tracking-[0.25em] muted-on-dark">Infrastructure et sécurité</p>
              <h4 class="mt-2 text-2xl font-semibold" style="color: white;">Audit de sécurité Microsoft 365</h4>

              <p class="mt-3 leading-relaxed soft-on-dark">
                Un portrait rapide et concret de votre posture de sécurité :
                MFA, comptes admin, partage externe, configurations de base et recommandations prioritaires.
              </p>

              <div class="mt-6 flex items-end justify-between gap-4 flex-wrap">
                <!-- <div>
                  <p class="text-sm muted-on-dark">Prix fixe</p>
                  <p style="color: white;">
                    <span class="text-5xl font-extrabold">$99</span>
                    <span class="muted-on-dark"> / audit</span>
                  </p>
                </div>-->

                <button
                  id="openAuditBtn"
                  class="px-6 py-3 rounded-xl font-semibold transition hover:brightness-110"
                  style={`
                    background: linear-gradient(90deg,
                      color-mix(in srgb, var(--accent) 92%, white 8%),
                      color-mix(in srgb, var(--accent) 72%, black 28%)
                    );
                    color: #111;
                  `}
                >
                  Demander l’audit
                </button>
              </div>

              <ul class="mt-6 list-disc ml-6 space-y-2 text-sm soft-on-dark">
                <li>Analyse des réglages clés Microsoft 365 / Entra ID</li>
                <li>Recommandations priorisées (quick wins + actions structurantes)</li>
                <li>Résumé clair pour la direction</li>
                <li>Option : plan de remédiation (sur demande)</li>
                <li>Vérification des 14 points listés ci-dessous</li>
              </ul>
            </div>
          </section>

          <!-- Contact -->
          <section class="group relative overflow-hidden rounded-2xl p-8 card-surface">
            <div class="pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 group-hover:opacity-100 hover-tint"></div>

            <div class="relative">
              <p class="text-xs uppercase tracking-[0.25em] muted-on-dark">Contact</p>
              <h4 class="mt-2 text-2xl font-semibold" style="color: white;">Parlez-nous de votre environnement</h4>

              <p class="mt-3 leading-relaxed soft-on-dark">
                Une question sur votre sécurité Microsoft 365, un audit (99$), ou un accompagnement?
                Envoyez-nous un message.
              </p>

              <button
                id="openContactBtn"
                class="inline-flex mt-6 px-6 py-3 rounded-xl font-semibold transition hover:brightness-110"
                style={`
                  background: rgba(255,255,255,0.06);
                  border: 1px solid rgba(255,255,255,0.10);
                  color: rgba(255,255,255,0.92);
                `}
              >
                Ouvrir le formulaire
              </button>

              <!-- Form -->
              <div id="contactFormContainer" class="overflow-hidden max-h-0 opacity-0 transition-all duration-500 mt-6">
                <form
                  id="contactForm"
                  class="space-y-4 p-6 rounded-xl"
                  style="background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10);"
                >
                  <h5 class="text-xl font-semibold mb-2" style="color: white;">Formulaire de contact</h5>

                  <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">Nom de l’organisation</label>
                  <input type="text" name="contact_org" required class="focus-ring w-full rounded-lg px-3 py-2"
                    style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;" />

                  <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">Courriel</label>
                  <input type="email" name="contact_email" required class="focus-ring w-full rounded-lg px-3 py-2"
                    style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;" />

                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">Téléphone (optionnel)</label>
                      <input type="text" name="contact_phone" class="focus-ring w-full rounded-lg px-3 py-2"
                        style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;" />
                    </div>
                    <div>
                      <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">Nb d’utilisateurs (optionnel)</label>
                      <input type="number" name="contact_users" min="1" class="focus-ring w-full rounded-lg px-3 py-2"
                        style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;" />
                    </div>
                  </div>

                  <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">Sujet</label>
                  <select name="contact_subject" class="focus-ring w-full rounded-lg px-3 py-2"
                    style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;">
                    <option value="Audit 365 - 99$">Audit Microsoft 365 (99$)</option>
                    <option value="Amelioration securite Microsoft 365">Amélioration sécurité Microsoft 365</option>
                    <option value="Soumission services geres">Soumission services gérés</option>
                    <option value="Autre">Autre</option>
                  </select>

                  <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">Message</label>
                  <textarea name="contact_message" rows="5" required class="focus-ring w-full rounded-lg px-3 py-2"
                    style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;"
                    placeholder="Ex : MFA, comptes admin, partage externe, télétravail, obligations Loi 25, etc."
                  ></textarea>

                  <input type="hidden" name="contact_source" value="securite365" />

                  <button type="submit" class="mt-2 w-full px-4 py-2 rounded-lg font-semibold transition hover:brightness-110"
                    style="background: var(--accent); color: #111;">
                    Envoyer
                  </button>

                  <button type="button" id="closeContactBtn" class="w-full px-4 py-2 rounded-lg font-medium transition hover:brightness-110"
                    style="background: rgba(255,255,255,0.06); color: white; border: 1px solid rgba(255,255,255,0.10);">
                    Fermer
                  </button>

                  <p id="contactStatus" class="text-sm mt-2 soft-on-dark"></p>
                </form>
              </div>
            </div>
          </section>

        </div>
      </div>

      <!-- 15 points -->
      <div class="relative mx-auto max-w-5xl px-4 pt-8 pb-24 grid gap-6">
        {points.map((p, i) => (
          <section class="group relative overflow-hidden rounded-2xl p-6 card-surface transition-all duration-300 hover:-translate-y-1">
            <div class="pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 group-hover:opacity-100 hover-tint"></div>

            <div class="relative flex items-start gap-5">
              <div class="shrink-0">
                <div class="grid place-items-center w-14 h-14 rounded-full"
                     style={`
                       background: rgba(0,0,0,0.25);
                       border: 2px solid color-mix(in srgb, var(--accent) 35%, transparent);
                       box-shadow: 0 0 18px color-mix(in srgb, var(--accent) 18%, transparent);
                     `}>
                  <span class="text-2xl font-extrabold" style="color: var(--accent);">{i + 1}</span>
                </div>
              </div>

              <div class="flex-1">
                <h3 class="text-lg md:text-xl font-semibold" style="color: white;">{p.t}</h3>

                <div class="mt-3 space-y-3 opacity-0 max-h-0 overflow-hidden transition-all duration-300 group-hover:opacity-100 group-hover:max-h-[900px]">
                  {p.lead.map((paragraph) => (
                    <p class="text-[15px] leading-relaxed soft-on-dark">{paragraph}</p>
                  ))}
                </div>
              </div>
            </div>
          </section>
        ))}
      </div>
    </section>

    <script>
      const openAuditBtn = document.getElementById("openAuditBtn");
      const openContactBtn = document.getElementById("openContactBtn");
      const closeContactBtn = document.getElementById("closeContactBtn");

      const panel = document.getElementById("contactFormContainer");
      const form = document.getElementById("contactForm");
      const status = document.getElementById("contactStatus");

      function openPanel(prefillSubject) {
        if (!panel) return;

        const subject = form?.querySelector('select[name="contact_subject"]');
        if (subject && prefillSubject) subject.value = prefillSubject;

        panel.style.maxHeight = panel.scrollHeight + "px";
        panel.style.opacity = "1";
        panel.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      if (openAuditBtn) openAuditBtn.addEventListener("click", () => openPanel("Audit 365 - 99$"));
      if (openContactBtn) openContactBtn.addEventListener("click", () => openPanel());

      if (closeContactBtn && panel) {
        closeContactBtn.addEventListener("click", () => {
          panel.style.maxHeight = "0";
          panel.style.opacity = "0";
        });
      }

      if (form && status) {
        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          const fd = new FormData(form);
          const data = {};
          for (const [k, v] of fd.entries()) data[k] = v;

          status.textContent = "Envoi…";

          try {
            const res = await fetch("/api/submit", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            });

            if (res.ok) {
              status.textContent = "Message envoyé!";
              form.reset();
            } else {
              status.textContent = "Erreur d’envoi.";
            }
          } catch (err) {
            status.textContent = "Erreur réseau.";
          }
        });
      }
    </script>
  </div>
</SiteLayout>
